<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>慕Mu 日式定食 - 數位菜單系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand-bg: #f1f1f1;
            --paper-bg: rgba(250, 249, 246, 0.98);
            --text-dark: #333333;
            --accent-red: #B23A2B;
            --accent-purple-grey: #5a5266;
            --sub-category-active: #8b8196;
            --title-color: #2e2e2e;
            --inactive-color: #8b8196;
        }
        body {
            background-color: var(--brand-bg);
            font-family: 'Noto Sans TC', sans-serif;
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            overflow: hidden; /* 防止整體頁面捲動 */
        }
        
        [v-cloak] { display: none !important; }
        
        #pre-loader-static {
            position: fixed;
            inset: 0;
            z-index: 1000;
            background: #f1f1f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .font-brand { font-family: 'Noto Serif TC', serif; }
        
        .glass-panel {
            background: var(--paper-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        /* 內部捲軸美化 */
        .scroll-container::-webkit-scrollbar { width: 4px; }
        .scroll-container::-webkit-scrollbar-thumb {
            background: rgba(139, 129, 150, 0.3);
            border-radius: 10px;
        }
        
        .bookmark-tab {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            margin-right: -4px; 
            z-index: 10;
        }
        
        @media (min-width: 768px) {
            .bookmark-tab { margin-right: -6px; }
        }
        
        .bookmark-tab-active {
            background: var(--paper-bg);
            color: var(--title-color) !important;
            z-index: 50; 
            margin-bottom: -1px; 
            box-shadow: 0 -8px 20px rgba(0,0,0,0.05);
            border-top: 1px solid rgba(255,255,255,1);
            transform: translateY(-1px);
        }
        
        .bookmark-tab-inactive {
            background: rgba(0, 0, 0, 0.05);
            color: var(--inactive-color) !important;
            transform: translateY(2px);
            z-index: 10;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tap-scale:active { transform: scale(0.98); }
        
        .sub-switch-active {
            background-color: var(--sub-category-active);
            color: white;
            box-shadow: 0 4px 12px rgba(139, 129, 150, 0.4);
        }
        
        .list-card {
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .list-card:hover {
            transform: translateY(-4px);
            background-color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.06);
        }
        
        .loader {
            border: 2px solid rgba(0,0,0,0.05);
            border-top: 2px solid #5a5266;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .custom-checkbox {
            appearance: none;
            width: 16px;
            height: 16px;
            border: 1.5px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        .custom-checkbox:checked {
            background-color: var(--accent-purple-grey);
            border-color: var(--accent-purple-grey);
        }
        .custom-checkbox:checked::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.5s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex flex-col">
    
    <!-- 靜態載入畫面 -->
    <div id="pre-loader-static">
        <div class="flex flex-col items-center gap-6 text-center">
            <div class="loader mx-auto"></div>
            <div class="text-center">
                <p class="font-brand text-xl font-bold tracking-[0.5em] text-[#2e2e2e] opacity-40 uppercase">MU TEISHOKU</p>
                <p class="text-[10px] tracking-[0.3em] text-gray-400 mt-2 uppercase">System Loading</p>
            </div>
        </div>
    </div>

    <div id="app" class="h-full flex flex-col" v-cloak>
        <!-- 主應用程式介面 -->
        <div v-if="isSystemReady" class="h-full flex flex-col relative animate-in fade-in duration-1000">
            
            <!-- 管理模式控制條 -->
            <div v-if="isEditMode" class="bg-black text-white p-2 text-center text-[10px] sm:text-xs font-bold tracking-[0.2em] z-[60] shrink-0 uppercase flex items-center justify-center gap-4">
                <span v-if="isSaving" class="flex items-center gap-2 italic text-center text-center text-center text-center"><div class="loader !w-3 !h-3 !border-t-white"></div> 雲端同步中...</span>
                <span v-else>管理員模式：內容修改將即時同步至所有螢幕</span>
                <button @click="toggleEditMode" :disabled="isSaving" class="bg-white text-black px-4 py-0.5 rounded-full font-bold hover:bg-gray-200 transition-colors disabled:opacity-50 text-center text-center">
                    儲存並退出
                </button>
            </div>

            <!-- 頂部頁首 -->
            <header class="w-full px-4 sm:px-8 lg:px-12 pt-1.5 md:pt-2 pb-1 flex justify-between items-center z-40 shrink-0">
                <div class="flex items-center gap-3 md:gap-6 text-left">
                    <div class="relative group shrink-0 text-left">
                        <div class="h-12 sm:h-16 md:h-20 w-auto flex items-center justify-center overflow-hidden transition-transform hover:scale-105 border border-transparent text-left">
                            <img v-if="menu.logo" :src="menu.logo" alt="Logo" class="h-full w-auto object-contain scale-110" />
                            <div v-else class="flex flex-col items-center justify-center text-gray-400 text-center border-2 border-dashed border-gray-300 rounded-3xl h-full px-6 text-center text-center">
                                <i data-lucide="image" class="w-4 h-4 md:w-6 md:h-6 mb-1 opacity-50 text-center"></i>
                                <span class="text-[5px] md:text-[6px] font-bold tracking-tighter uppercase opacity-50 text-center text-center">LOGO</span>
                            </div>
                        </div>
                        <label v-if="isEditMode" class="absolute inset-0 bg-black/40 flex items-center justify-center cursor-pointer opacity-0 group-hover:opacity-100 transition-opacity rounded-2xl text-center text-center text-center">
                            <i data-lucide="camera" class="w-5 h-5 md:w-7 md:h-7 text-white text-center"></i>
                            <input type="file" class="hidden text-center" accept="image/*" @change="handleLogoUpload">
                        </label>
                    </div>
                    
                    <div class="flex flex-col items-start overflow-hidden text-left text-left text-left text-left">
                        <div class="flex flex-row items-center gap-x-3 sm:gap-x-5 mb-2 opacity-50 text-left leading-none text-left text-left">
                            <div class="flex items-center gap-1 text-[8px] sm:text-[10px] font-bold tracking-wider text-[#5a5266] text-left">
                                <i data-lucide="map-pin" class="w-2 h-2 sm:w-2.5 sm:h-2.5 text-[#B23B2B] text-center"></i>
                                <span v-if="!isEditMode">{{ menu.address }}</span>
                                <input v-else v-model="menu.address" class="bg-gray-100 border-b border-gray-400 outline-none rounded px-1">
                            </div>
                            <div class="flex items-center gap-1 text-[8px] sm:text-[10px] font-bold tracking-wider text-[#5a5266] text-left text-left text-left">
                                <i data-lucide="phone" class="w-2 h-2 sm:w-2.5 sm:h-2.5 text-[#B23B2B] text-center text-left"></i>
                                <span v-if="!isEditMode">{{ menu.phone }}</span>
                                <input v-else v-model="menu.phone" class="bg-gray-100 border-b border-gray-400 outline-none rounded px-1">
                            </div>
                        </div>
                        <h1 class="text-lg sm:text-2xl md:text-3xl font-bold font-brand tracking-tighter leading-none truncate max-w-[200px] sm:max-w-none text-left text-left text-left text-left" style="color: var(--title-color)">
                            <span v-if="!isEditMode">{{ menu.storeName }}</span>
                            <input v-else v-model="menu.storeName" class="bg-black/5 border-b border-[#2e2e2e] outline-none px-2 rounded w-full" style="color: var(--title-color)">
                        </h1>
                    </div>
                </div>
                <button @click="handleAdminAuth" class="w-8 h-8 md:w-10 md:h-10 rounded-full bg-black/10 backdrop-blur-md flex items-center justify-center text-[#2e2e2e] shadow-sm border border-black/5 tap-scale shrink-0 text-center text-center text-center">
                    <i :data-lucide="isEditMode ? 'check' : 'settings'" class="w-4 h-4 md:w-5 md:h-5 text-center text-center text-center"></i>
                </button>
            </header>

            <!-- 分類標籤導覽 -->
            <nav class="w-full flex justify-start pl-12 sm:pl-24 lg:pl-32 pr-4 pt-0 items-end overflow-x-auto whitespace-nowrap z-40 no-scrollbar shrink-0 text-left text-left text-left">
                <div v-for="cat in menu.categories" :key="cat.id" class="flex items-center text-left text-left">
                    <div class="relative group text-center text-center text-center text-center">
                        <button @click="changeMainCategory(cat.id)"
                                :class="activeCategory === cat.id ? 'bookmark-tab-active' : 'bookmark-tab-inactive'"
                                class="bookmark-tab px-3 sm:px-4 md:px-6 pt-1 md:pt-1 pb-0.5 md:pb-0.5 rounded-t-lg sm:rounded-t-xl transition-all font-brand relative flex flex-col items-center text-center text-center text-center text-center text-center">
                            <template v-if="!isEditMode || editingTabId !== cat.id">
                                <span class="text-sm sm:text-lg md:text-xl font-bold tracking-[0.1em] text-center text-center text-center text-center leading-tight">{{ cat.name }}</span>
                                <span class="text-[6px] sm:text-[8px] md:text-[9px] font-sans uppercase tracking-tighter mt-0.5 opacity-70 text-center text-center text-center">{{ cat.nameEn }}</span>
                            </template>
                            <div v-else class="flex flex-col gap-0.5 items-center text-center text-center text-center">
                                <input v-model="cat.name" placeholder="中文" class="bg-black/5 border-b border-gray-400 outline-none px-1 text-xs sm:text-lg w-10 sm:w-20 text-center font-bold text-center text-center">
                                <input v-model="cat.nameEn" placeholder="ENG" class="bg-black/5 border-b border-gray-400 outline-none px-1 text-[6px] sm:text-[8px] w-10 sm:w-20 uppercase text-center text-center text-center">
                            </div>
                        </button>
                        <div v-if="isEditMode" class="absolute -top-8 left-1/2 -translate-x-1/2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-[60] text-center text-center text-center text-center">
                            <button @click="editingTabId = cat.id" class="bg-blue-500 text-white p-1 rounded-full shadow-lg text-center text-center text-center"><i data-lucide="edit-2" class="w-3 h-3 text-center text-center text-center"></i></button>
                            <button @click="triggerDelete('main-category', cat.id)" class="bg-red-500 text-white p-1 rounded-full shadow-lg text-center text-center text-center text-center"><span><i data-lucide="x" class="w-3 h-3 text-center text-center text-center"></i></span></button>
                        </div>
                    </div>
                </div>
                <button v-if="isEditMode" @click="addMainCategory" class="mb-1 ml-4 bg-black/5 text-gray-400 p-1.5 rounded-full hover:bg-black/10 transition-colors shrink-0 text-center text-center text-center text-center">
                    <i data-lucide="plus" class="w-3 h-3 md:w-4 md:h-4 text-center text-center text-center text-center text-center"></i>
                </button>
            </nav>

            <!-- 菜單主內容區塊 -->
            <main class="flex-grow glass-panel mx-0 sm:mx-4 rounded-t-[2rem] sm:rounded-t-[4rem] shadow-2xl overflow-hidden relative flex flex-col z-20 text-left text-left text-left">
                <div class="flex-grow overflow-y-auto scroll-container px-4 sm:px-8 md:px-12 lg:px-16 pt-4 pb-12 text-left text-left text-left text-left text-left">
                    
                    <!-- 子分類切換區 -->
                    <div class="flex flex-col items-center justify-center mb-8 border-b border-gray-100 pb-8 gap-6 text-center text-left text-left text-left text-left">
                        <div class="w-full flex items-center justify-center text-left text-left text-left">
                            <div class="flex flex-nowrap items-center justify-start sm:justify-center bg-gray-200/50 p-1 rounded-lg sm:rounded-[2rem] shadow-inner gap-1 overflow-x-auto no-scrollbar max-w-full text-left text-left">
                                <div v-for="sub in currentSubCategories" :key="sub.id" class="relative group flex-shrink-0 text-left text-left text-left text-left text-left">
                                    <button @click="activeSubCategory = sub.id" 
                                            :class="activeSubCategory === sub.id ? 'sub-switch-active' : 'text-gray-500 hover:text-gray-700'"
                                            class="px-4 sm:px-6 md:px-8 py-1.5 sm:py-2 rounded-lg sm:rounded-[1.5rem] transition-all flex flex-col items-center justify-center whitespace-nowrap min-w-0 text-left text-left">
                                        <template v-if="!isEditMode || editingSubTabId !== sub.id">
                                            <span class="text-sm sm:text-lg md:text-xl font-bold tracking-widest text-center text-center text-center text-center text-center">{{ sub.name }}</span>
                                            <span class="text-[8px] sm:text-[10px] font-sans uppercase tracking-tighter opacity-100 mt-0.5 text-center text-center text-center text-center text-center">{{ sub.nameEn }}</span>
                                        </template>
                                        <div v-else class="flex flex-col gap-0.5 items-center text-center text-center text-center text-center text-center text-center text-center">
                                            <input v-model="sub.name" placeholder="中文" class="bg-white/50 border-b border-gray-400 outline-none px-1 w-10 sm:w-16 text-xs sm:text-base text-center text-center text-center">
                                            <input v-model="sub.nameEn" placeholder="ENG" class="bg-white/50 border-b border-gray-400 outline-none px-1 w-10 sm:w-16 text-[8px] sm:text-[10px] uppercase text-center text-center text-center text-center text-center">
                                        </div>
                                    </button>
                                    <div v-if="isEditMode" class="absolute -top-2 -right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity z-10 text-center text-center text-center text-center text-center text-center">
                                        <button @click="editingSubTabId = sub.id" class="bg-blue-400 text-white p-0.5 rounded-full shadow text-center text-center text-center text-center text-center text-center"><span><i data-lucide="edit-2" class="w-2.5 h-2.5 text-center text-center"></i></span></button>
                                        <button @click="triggerDelete('sub-category', sub.id)" class="bg-red-400 text-white p-0.5 rounded-full shadow text-center text-center text-center text-center text-center text-center"><span><i data-lucide="x" class="w-2.5 h-2.5 text-center text-center text-center"></i></span></button>
                                    </div>
                                </div>
                                <button v-if="isEditMode" @click="addSubCategory" class="px-2 text-gray-400 hover:text-[#8b8196] flex-shrink-0 text-center text-center text-center text-center text-center">
                                    <span><i data-lucide="plus-circle" class="w-6 h-6 sm:w-8 h-8 text-center text-center"></i></span>
                                </button>
                            </div>
                        </div>

                        <!-- 定食特色說明 -->
                        <div v-if="activeCategory === 'teishoku'" class="flex flex-col items-center animate-in fade-in slide-in-from-top-2 duration-700 w-full mx-auto text-center text-left text-left text-left text-left text-left">
                            <div class="bg-[#5a5266]/5 border border-[#5a5266]/15 px-4 sm:px-6 py-2 rounded-xl sm:rounded-[1.5rem] shadow-sm text-center w-fit mx-auto text-left text-left text-left">
                                <template v-if="!isEditMode">
                                    <p class="text-[#5a5266] font-bold text-sm sm:text-lg md:text-xl tracking-[0.2em] sm:tracking-[0.4em] text-center text-center text-center text-center text-center text-center">{{ menu.teishokuDesc }}</p>
                                    <p class="text-gray-400 text-[9px] sm:text-[12px] md:text-[14px] font-sans uppercase tracking-[0.1em] mt-1 italic text-center text-center text-center text-center text-center text-center">{{ menu.teishokuDescEn }}</p>
                                    <div class="w-10 sm:w-16 h-[1px] bg-[#5a5266]/20 mx-auto my-1 text-center text-center text-center text-center text-center text-center"></div>
                                    <p class="text-gray-500 text-[9px] sm:text-[11px] md:text-[14px] font-medium tracking-wide text-center text-center text-center text-center text-center text-center">{{ menu.teishokuRefill }}</p>
                                    <p class="text-gray-400 text-[7px] sm:text-[9px] md:text-[11px] font-sans uppercase tracking-tighter mt-0.5 opacity-80 text-center text-center text-center text-center text-center text-center text-center text-center text-center">{{ menu.teishokuRefillEn }}</p>
                                </template>
                                <div v-else class="flex flex-col gap-2 text-center text-left text-left text-left text-left text-left text-left text-left text-left">
                                    <div class="space-y-1 text-center text-left text-left text-left text-left text-left text-left">
                                        <input v-model="menu.teishokuDesc" class="bg-white/80 border-b border-dashed border-[#5a5266] outline-none text-[#5a5266] px-2 text-center text-sm md:text-lg font-bold w-full text-left" placeholder="附贈說明(中)">
                                        <input v-model="menu.teishokuDescEn" class="bg-white/80 border-b border-dashed border-gray-300 outline-none text-gray-400 px-2 text-center text-[9px] md:text-xs uppercase tracking-widest w-full text-left text-left" placeholder="DESC(EN)">
                                    </div>
                                    <div class="space-y-1 border-t border-gray-100 pt-1 text-center text-left text-left">
                                        <input v-model="menu.teishokuRefill" class="bg-white/80 border-b border-dashed border-gray-300 outline-none text-gray-400 px-2 text-center text-[10px] md:text-sm w-full text-left text-left" placeholder="續加說明(中)">
                                        <input v-model="menu.teishokuRefillEn" class="bg-white/80 border-b border-dashed border-gray-200 outline-none text-gray-300 px-2 text-center text-[8px] md:text-[10px] uppercase tracking-tighter w-full text-left text-left" placeholder="REFILL INFO(EN)">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 餐點清單網格 -->
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-4 sm:gap-6 lg:gap-8 text-left text-left text-left text-left">
                        <div v-for="(item, idx) in displayedItems" :key="item.id" 
                             class="list-card group bg-white/70 hover:bg-white rounded-2xl sm:rounded-3xl p-3.5 sm:p-5 border border-gray-100 flex items-center transition-all shadow-sm hover:shadow-lg text-left text-[#333333] text-left text-left text-left text-left text-left text-left">
                            
                            <div class="flex-grow flex flex-col justify-center gap-1 overflow-hidden h-full text-left text-left text-left text-left text-left text-left text-left">
                                <div class="flex flex-col items-start w-full overflow-hidden text-left text-left text-left text-left text-left text-left text-left text-left">
                                    <div class="w-full border-b border-gray-100 pb-0.5 mb-0.5 flex flex-col text-left text-left text-left text-left text-left text-left text-left">
                                        <h3 v-if="!isEditMode" class="text-lg sm:text-2xl md:text-2xl font-bold font-brand tracking-wide text-[#1A1A1A] leading-tight whitespace-normal break-words flex items-center flex-wrap text-left text-left text-left text-left">
                                            {{ item.name }}
                                            <span v-if="item.isRecommended" class="ml-2 inline-flex items-center text-amber-400 text-center text-center text-center text-center text-center text-center text-center text-center text-center" title="推薦">
                                                <svg viewBox="0 0 24 24" class="w-5 h-5 sm:w-6 sm:h-6 fill-current text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M12 2l1.2 5.8L19 9l-5.8 1.2L12 16l-1.2-5.8L5 9l5.8-1.2L12 2z" />
                                                    <path d="M20 14l0.5 2.5 2.5 0.5-2.5 0.5L20 20l-0.5-2.5-2.5-0.5 2.5-0.5L20 14z" opacity="0.6"/>
                                                    <path d="M4 14l0.3 1.7 1.7 0.3-1.7 0.3L4 18l-0.3-1.7-1.7-0.3 1.7-0.3L4 14z" opacity="0.4"/>
                                                </svg>
                                            </span>
                                            <span v-if="item.isSpicy" class="ml-1.5 inline-flex items-center text-red-500 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                                <svg viewBox="0 0 24 24" class="w-5 h-5 sm:w-6 sm:h-6 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                                    <g transform="translate(4, 2)">
                                                        <path d="M8 2c-0.5 0-1 0.5-1 1s0.3 1.5 0.5 2C6 6 4 8.5 4 11.5 4 15 6.5 18 10 18s1-0.5 1-1c0-2-3-4-3-7.5 0-1 0.5-2.5 1-3.5L8 2z" fill="#EF4444" />
                                                        <path d="M7 0.5c0.5 0 1.2 0.5 1.2 1.5L8 5H6l0.2-3.5C6.2 0.5 6.5 0.5 7 0.5z" fill="#22C55E" />
                                                    </g>
                                                    <g transform="translate(10, 5) scale(0.85)">
                                                        <path d="M8 2c-0.5 0-1 0.5-1 1s0.3 1.5 0.5 2C6 6 4 8.5 4 11.5 4 15 6.5 18 10 18s1-0.5 1-1c0-2-3-4-3-7.5 0-1 0.5-2.5 1-3.5L8 2z" fill="#EF4444" />
                                                        <path d="M7 0.5c0.5 0 1.2 0.5 1.2 1.5L8 5H6l0.2-3.5C6.2 0.5 6.5 0.5 7 0.5z" fill="#22C55E" />
                                                    </g>
                                                </svg>
                                            </span>
                                        </h3>
                                        <input v-else v-model="item.name" class="text-lg font-bold bg-white/80 border-b border-dashed border-gray-300 outline-none px-1 rounded w-full text-left text-left text-left">
                                    </div>

                                    <div class="flex items-end justify-between w-full gap-4 min-h-[1.2em] text-left text-left text-left text-left text-left">
                                        <div v-if="item.nameEn || isEditMode" class="flex-grow overflow-hidden text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                            <p v-if="!isEditMode" class="text-[9px] sm:text-[11px] md:text-[13px] text-gray-400 font-sans uppercase tracking-[0.1em] leading-snug italic whitespace-normal break-words line-clamp-2 text-left text-left text-left">
                                                {{ item.nameEn }}
                                            </p>
                                            <input v-if="isEditMode" v-model="item.nameEn" class="text-xs text-gray-400 font-sans uppercase tracking-widest bg-white/80 border-b border-dashed border-gray-200 outline-none px-1 rounded w-full text-left text-left text-left text-left text-left">
                                        </div>
                                        <div v-if="!isEditMode" class="shrink-0 text-right ml-auto self-end text-right text-right text-right text-right text-right text-right text-right text-right text-right">
                                            <span class="text-[#5a5266] font-bold text-lg sm:text-xl md:text-2xl tracking-tighter block leading-none whitespace-nowrap text-right text-right text-right text-right text-right text-right text-right text-right">
                                                <span class="text-[9px] sm:text-[11px] mr-0.5 font-sans opacity-50 text-right text-right text-right text-right text-right">NT$</span>{{ item.price }}
                                            </span>
                                        </div>
                                    </div>

                                    <!-- 口味標籤：字體放大 -->
                                    <div v-if="item.flavors || isEditMode" class="mt-1 w-full flex flex-wrap gap-1.5 text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                        <div v-if="!isEditMode" class="bg-gray-100 px-2 py-0.5 rounded-lg flex items-center gap-1.5 opacity-70 text-left text-left text-left text-left text-left text-left text-left text-left">
                                            <i data-lucide="tag" class="w-3 h-3 text-gray-400 text-center text-center text-center text-center"></i>
                                            <span class="text-[11px] sm:text-[13px] font-medium text-gray-600 tracking-tight text-left text-left text-left text-left text-left text-left text-left">{{ item.flavors }}</span>
                                        </div>
                                        <div v-if="isEditMode" class="w-full flex items-center gap-2 bg-gray-50 px-2 py-1.5 rounded-lg text-left text-left text-left text-left text-left text-left text-left text-left">
                                            <i data-lucide="tag" class="w-3.5 h-3.5 text-gray-300 text-center text-center text-center text-center text-center"></i>
                                            <input v-model="item.flavors" placeholder="口味標示 (例如：柚子/原味/去冰)" class="bg-transparent border-b border-dashed border-gray-300 outline-none text-[12px] text-gray-500 w-full font-bold text-left text-left text-left text-left text-left">
                                        </div>
                                    </div>
                                </div>
                                
                                <div v-if="isEditMode" class="flex flex-col sm:flex-row sm:items-center justify-between gap-2 mt-2 pt-2 border-t border-dashed border-gray-100 text-left text-left text-left text-left text-left text-left text-left">
                                    <div class="flex items-center gap-6 text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                        <label class="flex items-center gap-2 cursor-pointer text-xs font-bold text-amber-600 text-left text-left text-left text-left text-left">
                                            <input type="checkbox" v-model="item.isRecommended" class="custom-checkbox text-left text-left text-left text-left text-left text-left"> 推薦 (星星)
                                        </label>
                                        <label class="flex items-center gap-2 cursor-pointer text-xs font-bold text-red-600 text-left text-left text-left text-left text-left text-left text-left">
                                            <input type="checkbox" v-model="item.isSpicy" class="custom-checkbox text-left text-left text-left text-left text-left text-left"> 辣味 (辣椒)
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-end gap-3 text-left text-left text-left text-left text-left text-left text-left">
                                        <div class="flex items-center gap-1 text-left text-left text-left text-left text-left text-left text-left">
                                            <span class="text-xs text-[#5a5266] font-bold text-right text-left text-left text-left text-left">NT$</span>
                                            <input v-model.number="item.price" type="number" class="w-20 sm:w-24 text-right font-bold text-lg bg-white border-b border-dashed border-[#5a5266]/40 outline-none text-right text-right text-right text-right text-right">
                                        </div>
                                        <button @click="triggerDelete('item', idx)" class="text-red-400 hover:text-red-600 p-2 transition-colors text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                            <span><i data-lucide="trash-2" class="w-5 h-5 text-center text-center text-center text-center"></i></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button v-if="isEditMode" @click="addItem" class="w-full border-2 border-dashed border-gray-200 rounded-2xl py-6 flex flex-col items-center justify-center text-gray-300 hover:border-[#8b8196] hover:text-[#8b8196] hover:bg-white transition-all bg-white/10 group text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                            <span><i data-lucide="plus" class="w-8 h-8 mb-2 group-hover:rotate-90 transition-transform text-center text-center text-center text-center text-center"></i></span>
                            <span class="text-[10px] font-bold tracking-[0.4em] uppercase text-center text-center text-center text-center">新增菜單品項</span>
                        </button>
                    </div>

                    <!-- 酒精性飲料警語：改成可管理模式 -->
                    <div v-if="activeCategory === 'drinks' && activeSubCategory === 'alc'" class="mt-8 text-right border-t border-dashed border-red-100 pt-5 text-right text-right text-right text-right text-right text-right">
                         <div class="flex flex-col items-end gap-1.5">
                             <div v-for="(alcNotice, aIdx) in menu.alcoholNotices" :key="alcNotice.id" 
                                  class="flex items-center justify-end gap-3 text-[9px] sm:text-[11px] md:text-[12px] text-[#B23B2B] font-bold tracking-[0.05em] leading-tight group">
                                 <template v-if="!isEditMode">
                                     <p>{{ alcNotice.text }}</p>
                                 </template>
                                 <div v-else class="flex items-center gap-2">
                                     <input v-model="alcNotice.text" class="bg-transparent border-b border-dashed border-[#B23B2B]/40 outline-none text-right font-bold w-48 sm:w-64" placeholder="酒精提醒標語">
                                     <button @click="triggerDelete('alcohol-notice', aIdx)" class="text-[#B23B2B] opacity-40 hover:opacity-100 transition-opacity p-0.5">
                                         <i data-lucide="trash-2" class="w-3.5 h-3.5"></i>
                                     </button>
                                 </div>
                             </div>
                             <button v-if="isEditMode" @click="addAlcoholNotice" 
                                     class="mt-2 text-[9px] font-bold text-gray-400 border border-dashed border-gray-300 px-3 py-1.5 rounded-full hover:bg-white hover:text-[#5a5266] transition-all w-fit">
                                 <i data-lucide="plus" class="w-3 h-3 inline mr-1"></i> 新增標語
                             </button>
                         </div>
                    </div>

                    <!-- 資訊頁尾 -->
                    <footer class="mt-16 sm:mt-24 pt-12 border-t border-gray-100 flex flex-col gap-6 opacity-60 text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                        <div class="flex flex-col gap-2.5 text-left w-full xl:w-auto text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                            <div v-for="(notice, nIdx) in menu.footerNotices" :key="notice.id" 
                                 class="flex items-center justify-start gap-3 text-[#B23B2B] font-bold text-[9px] sm:text-[12px] bg-[#B23B2B]/5 px-4 py-1.5 rounded-xl border border-[#B23B2B]/10 w-fit group text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                <i data-lucide="info" class="w-3.5 h-3.5 shrink-0 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center"></i>
                                <div class="flex-grow flex items-center gap-3 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                    <div v-if="!isEditMode" class="flex flex-col text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                        <span class="leading-relaxed">{{ notice.text }}</span>
                                        <span v-if="notice.textEn" class="text-[7px] sm:text-[9px] opacity-70 font-sans uppercase italic leading-tight text-left text-left text-left text-left text-left text-left text-left text-left">{{ notice.textEn }}</span>
                                    </div>
                                    <div v-else class="flex-grow flex flex-col gap-1 text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left text-left">
                                        <input v-model="notice.text" class="bg-transparent border-b border-dashed border-[#B23B2B]/40 outline-none w-full font-bold text-left text-left text-left text-left" placeholder="中文字幕">
                                        <input v-model="notice.textEn" class="bg-transparent border-b border-dashed border-[#B23B2B]/20 outline-none w-full font-normal text-[8px] text-red-700/60 text-left text-left text-left text-left text-left" placeholder="English caption">
                                    </div>
                                    <button v-if="isEditMode" @click="triggerDelete('footer-notice', nIdx)" 
                                            class="text-[#B23B2B] opacity-40 hover:opacity-100 transition-opacity p-1 text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                        <i data-lucide="trash-2" class="w-3.5 h-3.5 text-center text-center text-center text-center text-center text-center text-center text-center"></i>
                                    </button>
                                </div>
                            </div>
                            <button v-if="isEditMode" @click="addFooterNotice" 
                                    class="text-[9px] font-bold text-gray-400 border border-dashed border-gray-300 px-3 py-1.5 rounded-full hover:bg-white hover:text-[#5a5266] transition-all w-fit text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                <i data-lucide="plus" class="w-3 h-3 inline mr-1 text-center text-center text-center text-center"></i> 新增說明欄
                            </button>
                            <div class="mt-6 text-center w-full text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                                <p class="text-[7px] sm:text-[9px] text-gray-500 font-sans tracking-[0.4em] uppercase opacity-80 text-center text-center text-center text-center text-center text-center text-center text-center text-center">© 2026 MU TEISHOKU SYSTEM</p>
                            </div>
                        </div>
                    </footer>
                </div>
            </main>

            <!-- 確認刪除彈窗 -->
            <transition name="fade">
                <div v-if="deleteModal.show" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-md text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                    <div class="bg-[#FAF9F6] w-full max-sm:w-full max-w-sm rounded-[2rem] p-8 shadow-2xl text-center border-t-4 border-[#5a5266] animate-in zoom-in-95 duration-300 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                        <div class="w-12 h-12 bg-gray-50 rounded-full flex items-center justify-center mx-auto mb-6 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                            <span><i data-lucide="alert-triangle" class="w-10 h-10 text-[#5a5266] text-center text-center text-center text-center text-center text-center text-center text-center"></i></span>
                        </div>
                        <h3 class="text-xl font-bold font-brand mb-4 text-[#1A1A1A] text-center text-center text-center text-center text-center">確認刪除？</h3>
                        <p class="text-sm text-gray-500 mb-10 text-center text-center text-center text-center text-center text-center">永久移除「{{ deleteModal.title }}」？</p>
                        <div class="flex gap-4 justify-center text-center text-center text-center text-center text-center text-center text-center text-center">
                            <button @click="deleteModal.show = false" class="flex-1 py-4 bg-gray-100 rounded-2xl font-bold text-gray-500 hover:bg-gray-200 text-sm text-center text-center">取消</button>
                            <button @click="executeDelete" class="flex-1 py-4 bg-[#5a5266] text-white rounded-2xl font-bold shadow-lg text-sm text-center text-center text-center text-center text-center">確定刪除</button>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- 密碼驗證彈窗 -->
            <transition name="fade">
                <div v-if="showPasswordModal" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/60 backdrop-blur-md text-center text-center text-center text-center text-center">
                    <div class="bg-[#FAF9F6] w-full max-sm:w-full max-w-sm rounded-[2rem] p-10 shadow-2xl text-center border-t-8 border-[#8b8196] animate-in zoom-in-95 duration-300 text-center text-center text-center text-center text-center text-center text-center text-center">
                        <div class="w-16 h-16 bg-purple-50 rounded-full flex items-center justify-center mx-auto mb-6 text-center text-center text-center text-center text-center text-center text-center text-center text-center text-center">
                            <i data-lucide="lock" class="w-10 h-10 text-[#8b8196] text-center text-center text-center text-center"></i>
                        </div>
                        <h3 class="text-2xl font-bold font-brand mb-4 text-[#1A1A1A] text-center text-center text-center text-center text-center">管理員驗證</h3>
                        <p class="text-sm text-gray-500 mb-6 leading-relaxed text-center text-center text-center text-center text-center">請輸入管理密碼以進入編輯模式</p>
                        <input v-model="passwordInput" type="password" @keyup.enter="verifyPassword"
                               :class="passwordError ? 'border-red-500 ring-red-100' : 'border-gray-200 focus:ring-[#8b8196]/20'"
                               class="w-full px-6 py-4 bg-white border rounded-2xl outline-none focus:ring-4 transition-all mb-4 text-center font-bold tracking-widest text-sm text-center text-center"
                               placeholder="輸入密碼">
                        <p v-if="passwordError" class="text-xs text-red-500 mb-6 font-bold text-center text-center text-center text-center text-center">密碼不正確</p>
                        <div class="flex gap-4 justify-center text-center text-center text-center text-center text-center text-center">
                            <button @click="showPasswordModal = false" class="flex-1 py-4 bg-gray-100 rounded-2xl font-bold text-gray-500 hover:bg-gray-200 transition-colors text-sm text-center text-center text-center">取消</button>
                            <button @click="verifyPassword" class="flex-1 py-4 bg-[#8b8196] text-white rounded-2xl font-bold shadow-lg hover:brightness-110 transition-all text-sm text-center text-center text-center">確認進入</button>
                        </div>
                    </div>
                </div>
            </transition>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // 強制鎖定 AppId 確保資料路徑
        const appId = 'mu-teishoku-v2';
        
        const firebaseConfig = {
            apiKey: "AIzaSyBkaLqLfw6QJRtb91JjowTBF1iu4NCgpR4",
            authDomain: "mu-s-3d758.firebaseapp.com",
            projectId: "mu-s-3d758",
            storageBucket: "mu-s-3d758.firebasestorage.app",
            messagingSenderId: "516093609229",
            appId: "1:516093609229:web:12ad9f669421daaf29dc44",
            measurementId: "G-NJC0E4M7KF"
        };

        const firebaseApp = initializeApp(firebaseConfig);
        const analytics = getAnalytics(firebaseApp);
        const db = getFirestore(firebaseApp);
        const auth = getAuth(firebaseApp);

        const { createApp, ref, computed, onMounted, onUpdated, nextTick } = Vue;

        createApp({
            setup() {
                const isEditMode = ref(false);
                const isSaving = ref(false);
                const isSystemReady = ref(false); 
                const editingTabId = ref(null);
                const editingSubTabId = ref(null);
                const activeCategory = ref('teishoku');
                const activeSubCategory = ref('raw');
                const user = ref(null);
                let unsubscribeSnapshot = null;

                // 清空初始資料
                const menu = ref({
                    storeName: "", logo: null, address: "", phone: "",
                    teishokuDesc: "", teishokuDescEn: "", teishokuRefill: "", teishokuRefillEn: "",
                    footerNotices: [], 
                    alcoholNotices: [], // 新增酒精標語欄位
                    categories: [], content: {}
                });

                const showPasswordModal = ref(false);
                const passwordInput = ref('');
                const passwordError = ref(false);
                const deleteModal = ref({ show: false, type: '', title: '', id: null, index: null });

                const startRealTimeSync = () => {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'configs', 'menu');
                    unsubscribeSnapshot = onSnapshot(docRef, (docSnap) => {
                        if (docSnap.exists()) {
                            if (!isEditMode.value) {
                                const data = docSnap.data();
                                // 數據相容性校正
                                if (!data.footerNotices) data.footerNotices = [];
                                if (!data.alcoholNotices) data.alcoholNotices = getDefaultAlcNotices();
                                menu.value = data;
                            }
                        } else {
                            initEmptyMenu();
                        }
                        isSystemReady.value = true;
                        const preLoader = document.getElementById('pre-loader-static');
                        if (preLoader) preLoader.remove();
                    }, (err) => {
                        console.error("同步失敗:", err);
                        isSystemReady.value = true;
                    });
                };

                const getDefaultAlcNotices = () => [
                    { id: 1, text: "未滿十八歲禁止飲酒。" },
                    { id: 2, text: "No alcohol for persons under 18." },
                    { id: 3, text: "開車不喝酒，酒後不開車。" },
                    { id: 4, text: "Don’t drink and drive." }
                ];

                const initEmptyMenu = () => {
                    menu.value = {
                        storeName: "慕Mu 日式定食", logo: null, address: "台北市文青區", phone: "02-1234-5678",
                        footerNotices: [{ id: 1, text: "歡迎光臨", textEn: "Welcome" }],
                        alcoholNotices: getDefaultAlcNotices(),
                        categories: [{ id: 'teishoku', name: '定食', nameEn: 'SET MEAL', subCategories: [{id: 'raw', name: '生', nameEn: 'RAW'}] }],
                        content: { teishoku: { raw: [] } }
                    };
                };

                const saveMenuData = async () => {
                    if (!user.value) return;
                    isSaving.value = true;
                    try {
                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'configs', 'menu');
                        await setDoc(docRef, JSON.parse(JSON.stringify(menu.value)));
                    } catch (error) { console.error("儲存失敗:", error); } 
                    finally { isSaving.value = false; }
                };

                const handleAdminAuth = () => {
                    if (isEditMode.value) { toggleEditMode(); } 
                    else { passwordInput.value = ''; passwordError.value = false; showPasswordModal.value = true; }
                };

                const verifyPassword = () => {
                    if (passwordInput.value === 'good0722') { isEditMode.value = true; showPasswordModal.value = false; } 
                    else { passwordError.value = true; }
                };

                const toggleEditMode = async () => {
                    if (isEditMode.value) { await saveMenuData(); isEditMode.value = false; }
                    else { isEditMode.value = true; }
                };

                const currentSubCategories = computed(() => {
                    const cat = menu.value.categories.find(c => c.id === activeCategory.value);
                    return cat ? cat.subCategories : [];
                });

                const displayedItems = computed(() => {
                    const main = menu.value.content[activeCategory.value];
                    if (!main || !activeSubCategory.value) return [];
                    return main[activeSubCategory.value] || [];
                });

                const changeMainCategory = (id) => {
                    activeCategory.value = id;
                    const subs = currentSubCategories.value;
                    if (subs.length > 0) activeSubCategory.value = subs[0].id;
                };

                const addMainCategory = () => {
                    const id = 'mcat_' + Date.now();
                    menu.value.categories.push({ id, name: '新分類', nameEn: 'NEW CATEGORY', subCategories: [{ id: 'sub_1', name: '預設', nameEn: 'SUB' }] });
                    menu.value.content[id] = { sub_1: [] };
                    changeMainCategory(id);
                };

                const addSubCategory = () => {
                    const id = 'scat_' + Date.now();
                    const mainCat = menu.value.categories.find(c => c.id === activeCategory.value);
                    if (mainCat) {
                        mainCat.subCategories.push({ id, name: '新分組', nameEn: 'NEW SUB' });
                        menu.value.content[activeCategory.value][id] = [];
                        activeSubCategory.value = id;
                    }
                };

                const addFooterNotice = () => {
                    menu.value.footerNotices.push({ id: Date.now(), text: "新的說明(中)", textEn: "New notice content (EN)" });
                };

                const addAlcoholNotice = () => {
                    menu.value.alcoholNotices.push({ id: Date.now(), text: "新的酒精警語" });
                };

                const triggerDelete = (type, target) => {
                    deleteModal.value.type = type;
                    if (type === 'main-category') {
                        deleteModal.value.title = menu.value.categories.find(c => c.id === target)?.name || '分類';
                        deleteModal.value.id = target;
                    } else if (type === 'sub-category') {
                        deleteModal.value.title = currentSubCategories.value.find(s => s.id === target)?.name || '分組';
                        deleteModal.value.id = target;
                    } else if (type === 'footer-notice') {
                        deleteModal.value.title = "底部說明欄";
                        deleteModal.value.index = target;
                    } else if (type === 'alcohol-notice') {
                        deleteModal.value.title = "酒精警語標語";
                        deleteModal.value.index = target;
                    } else {
                        deleteModal.value.title = displayedItems.value[target]?.name || '餐點';
                        deleteModal.value.index = target;
                    }
                    deleteModal.value.show = true;
                };

                const executeDelete = () => {
                    if (deleteModal.value.type === 'main-category') {
                        menu.value.categories = menu.value.categories.filter(c => c.id !== deleteModal.value.id);
                        delete menu.value.content[deleteModal.value.id];
                        if (activeCategory.value === deleteModal.value.id) changeMainCategory(menu.value.categories[0]?.id || '');
                    } else if (deleteModal.value.type === 'sub-category') {
                        const mainCat = menu.value.categories.find(c => c.id === activeCategory.value);
                        mainCat.subCategories = mainCat.subCategories.filter(s => s.id !== deleteModal.value.id);
                        delete menu.value.content[activeCategory.value][deleteModal.value.id];
                        if (activeSubCategory.value === deleteModal.value.id) activeSubCategory.value = mainCat.subCategories[0]?.id || '';
                    } else if (deleteModal.value.type === 'footer-notice') {
                        menu.value.footerNotices.splice(deleteModal.value.index, 1);
                    } else if (deleteModal.value.type === 'alcohol-notice') {
                        menu.value.alcoholNotices.splice(deleteModal.value.index, 1);
                    } else {
                        displayedItems.value.splice(deleteModal.value.index, 1);
                    }
                    deleteModal.value.show = false;
                };

                const addItem = () => {
                    displayedItems.value.push({ 
                        id: Date.now(), name: '新餐點', nameEn: 'NEW DISH',
                        price: 0, isRecommended: true, isSpicy: false, flavors: ''
                    });
                };

                const handleLogoUpload = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const r = new FileReader();
                        r.onload = (ev) => menu.value.logo = ev.target.result;
                        r.readAsDataURL(file);
                    }
                };

                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            try { await signInWithCustomToken(auth, __initial_auth_token); } 
                            catch (e) { await signInAnonymously(auth); }
                        } else { await signInAnonymously(auth); }
                    } catch (e) { isSystemReady.value = true; }
                };

                onMounted(async () => {
                    lucide.createIcons();
                    onAuthStateChanged(auth, (u) => {
                        user.value = u;
                        if (u) { startRealTimeSync(); } 
                        else { isSystemReady.value = true; }
                    });
                    await initAuth();
                });

                onUpdated(() => nextTick(() => lucide.createIcons()));

                return {
                    isEditMode, isSaving, isSystemReady, editingTabId, editingSubTabId, activeCategory, activeSubCategory, menu, 
                    displayedItems, currentSubCategories, deleteModal,
                    showPasswordModal, passwordInput, passwordError, handleAdminAuth, verifyPassword,
                    toggleEditMode, changeMainCategory, addMainCategory, addSubCategory, triggerDelete, executeDelete, addItem, handleLogoUpload, addFooterNotice, addAlcoholNotice
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
